{{#PASeparateSentenceCard}}

<!-- if there is no sentence audio, then sentence level pitch accent cannot be tested! -->
{{#SentenceAudio}}

<!--
  - tests pitch accent AND reading (you hopefully know the reading by now)
  - does NOT test meaning
-->

<div class="card-description">
  PA Sentence
  <div class="card-description-ver">Mining Card: Version 0.1.1.0</div>
</div>

<!-- note that for the PA separate sentence card, the front is ALWAYS a sentence -->
<!-- priority: AltDisplayPASentenceCard -> AltDisplay -> Sentence -->

<!-- option 1: AltDisplayPASentenceCard -->
{{#AltDisplayPASentenceCard}}
  <div class="expression expression--single" id="Display">{{furigana:AltDisplayPASentenceCard}}</div>
{{/AltDisplayPASentenceCard}}


{{^AltDisplayPASentenceCard}}
  <!-- option 2: AltDisplay (only if the original card is a sentence card) -->
  <!--IsSentenceCard and AltDisplay -->
  {{#IsSentenceCard}} {{#AltDisplay}}
      <div class="expression expression--single" id="Display">{{furigana:AltDisplay}}</div>
  {{/AltDisplay}} {{/IsSentenceCard}}

  <!-- option 3: Sentence -->
  <!-- opposite of above ~(IsSentenceCard ^ AltDisplay) -->
  {{#IsSentenceCard}} {{^AltDisplay}}
    <div class="expression expression--single" id="Display">「{{Sentence}}」</div>
  {{/AltDisplay}} {{/IsSentenceCard}}
  {{^IsSentenceCard}} {{#AltDisplay}}
    <div class="expression expression--single" id="Display">「{{Sentence}}」</div>
  {{/AltDisplay}} {{/IsSentenceCard}}
  {{^IsSentenceCard}} {{^AltDisplay}}
    <div class="expression expression--single" id="Display">「{{Sentence}}」</div>
  {{/AltDisplay}} {{/IsSentenceCard}}

{{/AltDisplayPASentenceCard}}

{{^AltDisplay}}
  <script>
    var selectSentence = function(temp) {
      // only chooses the sentence around the bold characters
      var firstMatch = temp.indexOf("<b>");
      var lastMatch = temp.lastIndexOf("</b>");

      // list of valid terminators
      // "removeEnd": is removed if found at the end of a sentence
      var terminators = {
        ".": {removeEnd: true},
        "。": {removeEnd: true},
        "．": {removeEnd: true},
        "︒": {removeEnd: true},

        "!": {removeEnd: false},
        "?": {removeEnd: false},
        "！": {removeEnd: false},
        "？": {removeEnd: false},
        "…": {removeEnd: false},
        "︕": {removeEnd: false},
        "︖": {removeEnd: false},
        "︙": {removeEnd: false},
      }


      if (firstMatch !== -1 && lastMatch !== -1) {
        var beginIdx = firstMatch;
        var endIdx = lastMatch;

        for (; beginIdx >= 0; beginIdx--) {
          if (temp[beginIdx] in terminators) {
            var obj = terminators[temp[beginIdx]];
            beginIdx++;

            //console.log(beginIdx);
            //console.log(temp[beginIdx]);
            break;
          }
        }

        for (; endIdx < temp.length; endIdx++) {
          if (temp[endIdx] in terminators) {
            var obj = terminators[temp[endIdx]];
            if (obj.removeEnd) {
                endIdx--;
            }

            //console.log(endIdx);
            //console.log(temp[endIdx]);
            //console.log(obj.removeEnd);
            break;
          }
        }

        // clamp
        if (beginIdx < 0) {
          beginIdx = 0;
        }
        if (endIdx > temp.length-1) {
          endIdx = temp.length-1;
        }

        temp = temp.substring(beginIdx, endIdx+1)

        // re-adds quotes if necessary
        if (temp[0] !== "「") {
          temp = "「" + temp;
        }
        if (temp[temp.length-1] !== "」") {
          temp = temp + "」";
        }
      }

      return temp;
    }

    sent = document.getElementById("Display");
    if (sent !== null) {
      /* processes the sentence (if there is no altdisplay)
       * - removes newlines
       * - finds the shortest possible sentence around the bolded characters
       */

      // removes linebreaks
      var temp = sent.innerHTML.replace(/<br>/g, "");

      // removes leading and trailing white space (equiv. of strip() in python)
      temp = temp.trim();

      // selects the smallest containing sentence
      //temp = selectSentence(temp);


      sent.innerHTML = temp;
    }
  </script>
{{/AltDisplay}}

<script>
  // THIS IS A HACK
  // https://forums.ankiweb.net/t/disabling-audio-autoplay-for-certain-fields/6318/3
  // https://forums.ankiweb.net/t/controlling-display-and-function-of-audio-buttons/10234
  var elem = document.querySelector(".soundLink, .replaybutton");
  if (elem) {
    elem.click();
  }
</script>
<span id="audio-front-silence" style="display:none">{{PASilence}}</span>
<span id="audio-front">{{SentenceAudio}}</span>

{{#HintNotHidden}}
  <div class="center-box-1 hint">
    <div class="center-box-2">
      <div class="bold-yellow">{{HintNotHidden}}</div>
    </div>
  </div>
{{/HintNotHidden}}

<!-- https://stackoverflow.com/questions/1269589/css-center-block-but-align-contents-to-the-left -->
<!-- tl;dr wrap anything you want centered + left justified with center-box-1 and center-box-2 -->
{{#Hint}}
  <details class="hint">
    <summary>Hint</summary>
    <div class="center-box-1">
      <div class="center-box-2">
        <div class="bold-yellow">{{Hint}}</div>
      </div>
    </div>
  </details>
{{/Hint}}


{{/SentenceAudio}}
{{/PASeparateSentenceCard}}