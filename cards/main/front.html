<!--
  Listening
  X / Y

  X:
    Word
    Sentence

  Y:
    Legacy
    None
    Word
    Sentence
-->

<div class="card-description">
  Mining Card:

  {{#IsSentenceCard}}
      Sentence
  {{/IsSentenceCard}}

  {{^IsSentenceCard}}
      Word
  {{/IsSentenceCard}}

  /

    {{#PADoNotShowInfoLegacy}}
      Legacy
    {{/PADoNotShowInfoLegacy}}

    <!-- not legacy card -->
    {{^PADoNotShowInfoLegacy}}


    <!--
    anki doesn't allow "or" logic in templates,
    so I replicate it by repeating things a bunch of times...

        A v B  = (A ^ ~B) v (~A ^ B) v (A ^ B)
        ~(A v B) =  ~A ^ ~B
    For more readable logic, check the "Word pitch indicator color" javascript code
    -->

    <!-- PADoNotTest or PASeparateWordCard == none -->
    {{#PADoNotTest}} {{#PASeparateWordCard}}
      None
    {{/PASeparateWordCard}} {{/PADoNotTest}}
    {{^PADoNotTest}} {{#PASeparateWordCard}}
      None
    {{/PASeparateWordCard}} {{/PADoNotTest}}
    {{#PADoNotTest}} {{^PASeparateWordCard}}
      None
    {{/PASeparateWordCard}} {{/PADoNotTest}}

    <!-- neither PADoNotTest, PASeparateWordCard are filled -->
    <!-- we then test the PA somewhere -->
    {{^PADoNotTest}} {{^PASeparateWordCard}}

      <!-- PASeparateSentenceCard or PATestOnlyWord == word -->
      {{#PASeparateSentenceCard}} {{^PATestOnlyWord}}
        Word
      {{/PATestOnlyWord}} {{/PASeparateSentenceCard}}
      {{^PASeparateSentenceCard}} {{#PATestOnlyWord}}
        Word
      {{/PATestOnlyWord}} {{/PASeparateSentenceCard}}
      {{#PASeparateSentenceCard}} {{#PATestOnlyWord}}
        Word
      {{/PATestOnlyWord}} {{/PASeparateSentenceCard}}

      <!-- if none of the above, then we test the default value -->
      {{^PASeparateSentenceCard}} {{^PATestOnlyWord}}

        {{#IsSentenceCard}}
            Sentence
        {{/IsSentenceCard}}

        {{^IsSentenceCard}}
            Word
        {{/IsSentenceCard}}

      {{/PATestOnlyWord}} {{/PASeparateSentenceCard}}

    {{/PASeparateWordCard}} {{/PADoNotTest}}

  {{/PADoNotShowInfoLegacy}}
</div>





<!-- legacy display -->
{{#PADoNotShowInfoLegacy}}

  <!-- priority is on the alternate display sentence -->
  {{#AltDisplay}}
    {{#IsSentenceCard}}
      <div class="expression expression--single" id="Display">{{furigana:AltDisplay}}</div>
    {{/IsSentenceCard}}

    {{^IsSentenceCard}}
      <div class="expression expression--single expression--word" id="Display">{{furigana:AltDisplay}}</div>
    {{/IsSentenceCard}}
  {{/AltDisplay}}


  <!-- no alt display sentence, not listening card -->
  {{^AltDisplay}}
    {{#IsSentenceCard}}
      <div class="expression expression--single" id="Display">「{{Sentence}}」</div>
    {{/IsSentenceCard}}

    {{^IsSentenceCard}}
      <div class="expression expression--single expression--word" id="Display">{{Word}}</div>
    {{/IsSentenceCard}}
  {{/AltDisplay}}

{{/PADoNotShowInfoLegacy}}


<!-- regular display -->
{{^PADoNotShowInfoLegacy}}
  <div class="expression-box">

    <div class="flag-box">
      <svg xmlns="http://www.w3.org/2000/svg" focusable="false" viewBox="0 0 50 50"
        style="display:inline-block;vertical-align:middle;height:1.5em;">
        <circle id="svg_circle" class="flag-box__circle" cx="25" cy="15" r="7">
          <title id=svg_title></title>
        </circle>
      </svg>
    </div>

    {{#IsSentenceCard}}
      <!--
        different circle positions depending on whether it's a sentence or not.
        More specifically, checks if the first character is "「",
        and adjusts the position based on that
      -->
      <script>
        var circ = document.getElementById("svg_circle");
        var d = document.getElementById("Display");
        if (d.innerText.length > 0 && d.innerText[0] == "「") {
          circ.setAttributeNS(null, "cx", "35");
          circ.setAttributeNS(null, "cy", "11");
        }
      </script>
    {{/IsSentenceCard}}

    <script>
      // ============================
      //  Word pitch indicator color
      // ============================
      var svgTitle = document.getElementById("svg_title");
      var styleClass = "";

      if ("{{PADoNotTest}}{{PASeparateWordCard}}") {
        // PADoNotTest or PASeparateWordCard
        styleClass = "flag-box__circle--none";
        svgTitle.textContent = "PA: Do not test";
      } else {
        if ("{{PASeparateSentenceCard}}{{PATestOnlyWord}}") {
          // either PASeparateSentenceCard or PATestOnlyWord
          styleClass = "flag-box__circle--word";
          svgTitle.textContent = "PA: Word";
        } else {
          styleClass = "flag-box__circle--all";
          svgTitle.textContent = "PA: Sentence";
        }

        // ~(isSentenceCard) overrides color (should 'test all')
        if (!"{{IsSentenceCard}}") {
          styleClass = "flag-box__circle--all"
        }
      }

      var circ = document.getElementById("svg_circle");
      circ.classList.add(styleClass);
    </script>



    <!-- priority is on the alternate display sentence -->
    {{#AltDisplay}}
      {{#IsSentenceCard}}
        <div class="expression" id="Display">{{furigana:AltDisplay}}</div>
      {{/IsSentenceCard}}

      {{^IsSentenceCard}}
        <div class="expression expression--word" id="Display">{{furigana:AltDisplay}}</div>
      {{/IsSentenceCard}}
    {{/AltDisplay}}


    <!-- no alt display sentence, not listening card -->
    {{^AltDisplay}}
      {{#IsSentenceCard}}
        <div class="expression" id="Display">「{{Sentence}}」</div>
      {{/IsSentenceCard}}

      {{^IsSentenceCard}}
        <div class="expression expression--word" id="Display">{{Word}}</div>
      {{/IsSentenceCard}}
    {{/AltDisplay}}

  </div>

{{/PADoNotShowInfoLegacy}}



{{#Hint}}
  <details>
    <summary class="hint">Hint</summary>
    <div class="center-box-1">
      <div class="center-box-2">
        <div class="hint bold-yellow">{{Hint}}</div>
      </div>
    </div>
  </details>
{{/Hint}}



<!-- regular display -->
<!-- displays the audio and show/hide button, used only when testing pitch accent -->
{{^PADoNotShowInfoLegacy}}

  {{^PADoNotTest}} {{^PASeparateWordCard}}

    <!-- if the display is a sentence but we only want to test word pitch accent -->
    {{#IsSentenceCard}}

      <!-- ankified `PASeparateSentenceCard or PATestOnlyWord` -->
      {{#PASeparateSentenceCard}} {{^PATestOnlyWord}}
        <button id="PAButton" oncontextmenu="event.preventDefault();" onclick="logMouseButton()">Show</button>
      {{/PATestOnlyWord}} {{/PASeparateSentenceCard}}
      {{^PASeparateSentenceCard}} {{#PATestOnlyWord}}
        <button id="PAButton" oncontextmenu="event.preventDefault();" onclick="logMouseButton()">Show</button>
      {{/PATestOnlyWord}} {{/PASeparateSentenceCard}}
      {{#PASeparateSentenceCard}} {{#PATestOnlyWord}}
        <button id="PAButton" oncontextmenu="event.preventDefault();" onclick="logMouseButton()">Show</button>
      {{/PATestOnlyWord}} {{/PASeparateSentenceCard}}

      <!-- script here because too lazy to copy/paste -->
      <!-- https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/button -->
      <script>
        var paButton = document.getElementById("PAButton");
        var d = document.getElementById("Display");

        function logMouseButton() {
          if (paButton.innerText == "Show") {
            paButton.innerText = "Hide";
            d.classList.add("bold-yellow");
          } else {
            paButton.innerText = "Show";
            d.classList = "expression";
          }
        }
      </script>

    {{/IsSentenceCard}}

  {{/PASeparateWordCard}} {{/PADoNotTest}}


  <!--
    if the display is a word: show sentence preview (spoilered)
    - note that it is guaranteed we test pitch accent here already
  -->
  {{^IsSentenceCard}}
    <details>
      <summary class=glossary-details>Full Sentence</summary>
      <div class="center-box-1">
        <div class="center-box-2">
          <div class="full-sentence bold-yellow" id="full_sentence_front">
            {{furigana:SentenceReading}}
          </div>
        </div>
      </div>
    </details>
  {{/IsSentenceCard}}


  <!-- we include the audio at the front regardless if we test PA or not -->
  <script>
    // =====================
    //  THIS PART IS A HACK
    // =====================
    // this hack is to not auto-play the audio at the front of the card
    // https://forums.ankiweb.net/t/disabling-audio-autoplay-for-certain-fields/6318/3
    // https://forums.ankiweb.net/t/controlling-display-and-function-of-audio-buttons/10234
    var elem = document.querySelector(".soundLink, .replaybutton");
    if (elem) {
      elem.click();
    }
  </script>

  <span id="audio-front-silence" style="display:none">{{PASilence}}</span>
  <span id="audio-front">
    {{#SentenceAudio}}
      {{SentenceAudio}}
    {{/SentenceAudio}}
    {{^SentenceAudio}}
      {{WordAudio}}
    {{/SentenceAudio}}
  </span>


{{/PADoNotShowInfoLegacy}}



