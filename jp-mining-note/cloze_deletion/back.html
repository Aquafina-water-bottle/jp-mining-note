{{#FrequenciesStylized}} {{FrequenciesStylized}} {{/FrequenciesStylized}}

<script>
  var logger = (function (my) {
    let _appendMsg = function (message, groupEle) {
      let msgEle = document.createElement("div");
      msgEle.classList.add("info-circle__message");
      if (Array.isArray(message)) {
        if (message.length > 0) {
          msgEle.textContent = message[0];

          for (let line of message.slice(1)) {
            let lineEle = document.createElement("div");
            lineEle.textContent = line;
            msgEle.appendChild(lineEle);
          }
        }
      } else {
        msgEle.textContent = message;
      }
      groupEle.appendChild(msgEle);
    };

    my.error = function (message) {
      var groupEle = document.getElementById("info_circle_text_error");
      _appendMsg(message, groupEle);
      var infoCirc = document.getElementById("info_circle");
      if (!infoCirc.classList.contains("info-circle-error")) {
        infoCirc.classList.add("info-circle-error");
      }
    };

    my.assert = function (condition, message) {
      if (!condition) {
        my.error("(assert) " + message);
      }
    };

    my.warn = function (message) {
      var groupEle = document.getElementById("info_circle_text_warning");
      _appendMsg(message, groupEle);
      var infoCirc = document.getElementById("info_circle");
      if (!infoCirc.classList.contains("info-circle-warning")) {
        infoCirc.classList.add("info-circle-warning");
      }
    };

    my.info = function (message) {
      var groupEle = document.getElementById("info_circle_text_info");
      _appendMsg(message, groupEle);
    };

    my.leech = function () {
      var groupEle = document.getElementById("info_circle_text_leech");
      _appendMsg("", groupEle);
      var infoCirc = document.getElementById("info_circle");
      if (!infoCirc.classList.contains("info-circle-leech")) {
        infoCirc.classList.add("info-circle-leech");
      }
    };

    return my;
  })(logger || {});

  // on any javascript error: log it
  window.onerror = function (msg, url, lineNo, columnNo, error) {
    //window.onerror = function(msg) {
    //logger.error("Javascript error: `" + msg + "`" + "\n" + error.stack);
    let stackList = error.stack.split(" at ");
    for (let i = 1; i < stackList.length; i++) {
      stackList[i] = ">>> " + stackList[i];
    }
    logger.error(stackList);
  };

  // https://stackoverflow.com/a/55178672
  window.onunhandledrejection = function (errorEvent) {
    logger.error("Javascript handler error: `" + errorEvent.reason + "`");
  };

  function optionsNotFound() {
    logger.warn(
      "Options file not found. Did you place the options file in the media directory?"
    );
  }
</script>

<script onerror="optionsNotFound();" src="jp-mining-note-options.js"></script>

<div class="card-description">
  Cloze Deletion

  <span class="info-circle" id="info_circle">
    <span class="info-circle-svg-wrapper">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="15"
        height="15"
        class="bi bi-info-circle"
        viewBox="0 0 16 16"
      >
        <path
          d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
        />
        <path
          d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"
        />
      </svg>
    </span>

    <span class="info-circle-text-wrapper">
      <span class="info-circle-text" id="info_circle_text">
        <div class="info-circle-text-error" id="info_circle_text_error"></div>
        <div
          class="info-circle-text-warning"
          id="info_circle_text_warning"
        ></div>
        <div class="info-circle-text-leech" id="info_circle_text_leech"></div>
        <div class="info-circle-text-info" id="info_circle_text_info">
          <div>
            Need help? View the
            <a
              href="https://github.com/Aquafina-water-bottle/jp-mining-note/wiki"
              >documentation</a
            >.
          </div>
          <div>
            Have an issue?
            <a
              href="https://github.com/Aquafina-water-bottle/jp-mining-note/issues"
              >Report it here</a
            >.
          </div>
          <div>
            View the
            <a href="https://github.com/Aquafina-water-bottle/jp-mining-note"
              >source code</a
            >.
          </div>
        </div>
      </span>
    </span>
  </span>

  <div class="card-description-ver">JP Mining Note: Version 0.8.1.0</div>
</div>

{{#AltDisplay}}
<div
  class="expression expression--single expression--sentence bold-yellow"
  id="Display"
>
  <span class="sentence-quote sentence-quote--open">「</span
  ><span>{{furigana:AltDisplay}}</span
  ><span class="sentence-quote sentence-quote--close">」</span>
</div>
{{/AltDisplay}} {{^AltDisplay}}
<div
  class="expression expression--single expression--sentence bold-yellow"
  id="Display"
>
  <span class="sentence-quote sentence-quote--open">「</span
  ><span>{{Sentence}}</span
  ><span class="sentence-quote sentence-quote--close">」</span>
</div>
{{/AltDisplay}} {{#HintNotHidden}}
<div class="center-box-1 hint">
  <div class="center-box-2">
    <div class="bold-yellow">{{HintNotHidden}}</div>
  </div>
</div>
{{/HintNotHidden}}

<!-- https://stackoverflow.com/questions/1269589/css-center-block-but-align-contents-to-the-left -->
<!-- tl;dr wrap anything you want centered + left justified with center-box-1 and center-box-2 -->
{{#Hint}}
<details class="hint" id="hint_details">
  <summary>Hint</summary>
  <div class="center-box-1">
    <div class="center-box-2">
      <div class="bold-yellow">{{Hint}}</div>
    </div>
  </div>
</details>
{{/Hint}}

<center>
  <div class="answer-border"></div>
</center>

<div class="def-header" id="def_header">
  <!-- everything on the left side -->

  <div class="dh-left" id="dh_left">
    <div class="dh-left__reading">{{furigana:WordReading}}</div>

    <div class="dh-left__word-pitch" id="dh_word_pitch">
      {{#WordPitch}} {{WordPitch}} {{/WordPitch}} {{^WordPitch}} (N/A)
      {{/WordPitch}}
    </div>

    <div class="dh-left__audio-buttons">
      <span id="word-audio"> {{WordAudio}} </span>
      <span id="sentence-audio"> {{SentenceAudio}} </span>
    </div>
  </div>

  <!-- everything on the right side -->
  {{#Picture}}
  <div class="dh-right" id="dh_right">
    <div class="dh-right__img-container" id="dh_img_container">{{Picture}}</div>
  </div>
  {{/Picture}}
</div>

<div id="back_side" class="back-side">
  <div class="center-box-1">
    <div class="center-box-2">
      <div class="full-sentence bold-yellow" id="full_sentence">
        {{furigana:SentenceReading}}
      </div>
    </div>
  </div>

  <!-- hides primary definition since the definition is not important for this card -->
  {{#PrimaryDefinition}}
  <details class="glossary-details">
    <summary>Primary Definition</summary>
    <blockquote class="glossary-blockquote bold-yellow" id="primary_definition">
      <div class="glossary-text glossary-text--primary-definition">
        {{furigana:PrimaryDefinition}}
      </div>
    </blockquote>
  </details>
  {{/PrimaryDefinition}} {{#SecondaryDefinition}}
  <details class="glossary-details" id="secondary_definition_details">
    <summary>Secondary Definition</summary>
    <blockquote class="glossary-blockquote bold-yellow">
      <div class="glossary-text glossary-text--secondary-definition">
        {{SecondaryDefinition}}
      </div>
    </blockquote>
  </details>
  {{/SecondaryDefinition}} {{#AdditionalNotes}}
  <details
    class="glossary-details glossary-details--small"
    id="additional_notes_details"
  >
    <summary>Additional Notes</summary>
    <blockquote
      class="glossary-blockquote glossary-blockquote--small bold-yellow"
    >
      <div class="glossary-text glossary-text--additional-notes">
        {{AdditionalNotes}}
      </div>
    </blockquote>
  </details>
  {{/AdditionalNotes}} {{#ExtraDefinitions}}
  <details
    class="glossary-details glossary-details--small"
    id="extra_definitions_details"
  >
    <summary>Extra Definitions</summary>
    <blockquote
      class="glossary-blockquote glossary-blockquote--small bold-yellow"
    >
      <div class="glossary-text glossary-text--extra-definitions">
        {{ExtraDefinitions}}
      </div>
    </blockquote>
  </details>
  {{/ExtraDefinitions}}

  <div
    class="outer-display1
    {{^PAGraphs}}{{^UtilityDictionaries}}
      outer-display2
    {{/UtilityDictionaries}}{{/PAGraphs}}"
    id="Display"
  >
    <!-- only showed if outer-display2 doesn't exist -->
    <details
      class="glossary-details glossary-details--small inner-display1"
      id="extra_info_details"
    >
      <summary>Extra Info</summary>
      <blockquote
        class="glossary-blockquote glossary-blockquote--small bold-yellow"
      >
        <div class="glossary-text glossary-text--extra-info">
          <div class="pa-graphs">{{PAGraphs}}</div>

          <div class="utility-dicts">{{UtilityDictionaries}}</div>
        </div>
      </blockquote>
    </details>
  </div>
</div>
<!-- backside -->

<!--
  https://codeconvey.com/html-image-zoom-on-click/
  http://www.liangshunet.com/en/202005/743233073.htm
  https://stackoverflow.com/questions/8449933/how-to-transition-css-display-opacity-properties
  https://www.javascripttutorial.net/dom/css/add-styles-to-an-element/
  https://stackoverflow.com/questions/507138/how-to-add-a-class-to-a-given-element
-->
<!-- The Modal -->
<div id="modal" class="modal">
  <img class="modal-img" id="bigimg" />
</div>

<script>
  /// ///

  // import settings as a global variable
  // https://forums.ankiweb.net/t/how-to-include-external-files-in-your-template-js-css-etc-guide/11719

  //function getAnkiPrefix() {
  //  // TODO cross-platform support
  //  // "https://appassets.androidplatform.net" ?
  //  return "./";
  //}
  //
  //var OPTIONS_FILE = "jp-mining-note-options.js"; // const screws up anki for some reason lol

  // import statements cannot be contained in a function, if statement, etc.
  //import {createOptions} from getAnkiPrefix() + OPTIONS_FILE;

  //import {createOptions} from "./jp-mining-note-options.js";

  (function () {
    // restricts ALL javascript to hidden scope

    // TODO remove this at some point and replace with proper checks
    var note = (function () {
      let my = {};
      my.colorQuotes = false;
      return my;
    })();

    var getSetting = function (keys, defaultVal) {
      let keyList = ["settings"].concat(keys);

      let obj = JPMNOpts;
      for (let key of keyList) {
        if (!(key in obj)) {
          logger.warn(
            "Option " + keys.join(".") + " is not defined in the options file."
          );
          return defaultVal;
        }
        obj = obj[key];
      }
      return obj;
    };

    // global variable to set the PA indicator color (as a css class)
    /// {{#PAShowInfo}}
    var paIndicator = (function () {
      let my = {};
      my.type = null;
      my.className = null;
      my.tooltip = null;

      if (
        "{{#PADoNotTest}}a{{/PADoNotTest}}{{#PASeparateWordCard}}a{{/PASeparateWordCard}}"
      ) {
        my.type = "none";
      } else if (
        "{{#PASeparateSentenceCard}}a{{/PASeparateSentenceCard}}{{#PATestOnlyWord}}a{{/PATestOnlyWord}}"
      ) {
        my.type = "word";
      } else if ("{{#IsSentenceCard}}a{{/IsSentenceCard}}") {
        my.type = "sentence";
      } else {
        my.type = "word";
      }

      my.className = "pa-indicator-color--" + my.type;

      if (my.type === "none") {
        my.tooltip = "Do not test";
      } else if (my.type == "word") {
        my.tooltip = "Word";
      } else {
        // sentence
        my.tooltip = "Sentence";
      }

      return my;
    })();
    /// {{/PAShowInfo}} // PAShowInfo

    ///

    /*
     * processes the sentence (if there is no altdisplay)
     * - removes newlines
     * - replaces bold with [...] if cloze deletion
     * - handles adding or replacing quotes if specified
     *
     * isAltDisplay=false
     */
    var processSentence = function (sentEle, isAltDisplay, isClozeDeletion) {
      if (!getSetting(["sentence", "enabled"], true)) {
        return;
      }

      if (typeof isAltDisplay === "undefined") {
        logger.warn("isAltDisplay is undefined");
        isAltDisplay = false;
      }

      // removes linebreaks
      var result = sentEle.children[1].innerHTML;

      // cloze deletion replacing bold with [...]
      if (typeof isClozeDeletion !== "undefined" && isClozeDeletion) {
        result = result.replace(/<b>.*?<\/b>/g, "<b>[...]</b>");
      }

      if (
        (!isAltDisplay &&
          getSetting(["sentence", "remove-line-breaks"], true)) ||
        (isAltDisplay &&
          getSetting(["sentence", "remove-line-breaks-on-altdisplay"], false))
      ) {
        let noNewlines = result.replace(/<br>/g, "");

        // automatically removes newlines and other html elements
        // https://stackoverflow.com/a/54369605
        let charCount = [...sentEle.innerText.trim()].length;
        let maxCharCount = getSetting(
          ["sentence", "remove-line-breaks-until-char-count"],
          30
        );

        if (maxCharCount === 0 || charCount <= maxCharCount) {
          result = noNewlines;
        }
      }

      // removes leading and trailing white space (equiv. of strip() in python)
      result = result.trim();

      // selects the smallest containing sentence

      //if (!isAltDisplay && settings.sentence("select-smallest-sentence")) {
      //  result = selectSentence(result);
      //}

      //if (settings.quote("enabled", true)) {
      //  result = processQuote(sentEle, result, isAltDisplay);
      //} else {
      //  sentEle.innerHTML = result;
      //}

      //var processQuote = function(sentEle, sent, isAltDisplay) {
      //let result = sent;

      //let openQuote = null;
      //let closeQuote = null;
      //let validQuotes = settings.quote("quote-match-strings", [["「", "」"]])

      // if existing quotes:
      //     remove from sentence
      //     add to quote spans
      // if no existing quotes and if autoquote:
      //     add autoquote open / close to quote spans (if different)
      // if color quotes:
      //     add color quote class to outer divs

      let validQuotes = getSetting(
        ["sentence", "quote-match-strings"],
        [
          ["「", "」"],
          ["『", "』"],
        ]
      );
      let existingQuote = false;

      let openQuoteEle = sentEle.children[0];
      let closeQuoteEle = sentEle.children[2];

      for (let quotePair of validQuotes) {
        if (
          result[0] === quotePair[0] &&
          result[result.length - 1] === quotePair[1]
        ) {
          // adds quote to surrounding divs
          let openQuote = null;
          let closeQuote = null;
          [openQuote, closeQuote] = quotePair;
          openQuoteEle.innerText = openQuote;
          closeQuoteEle.innerText = closeQuote;

          result = result.slice(1, -1);
          existingQuote = true;
          break;
        }
      }

      let autoQuote =
        (!isAltDisplay &&
          getSetting(["sentence", "auto-quote-sentence"], true)) ||
        (isAltDisplay &&
          getSetting(["sentence", "auto-quote-alt-display-sentence"], false));
      if (!existingQuote && autoQuote) {
        openQuoteEle.innerText = getSetting(
          ["sentence", "auto-quote-open"],
          "「"
        );
        closeQuoteEle.innerText = getSetting(
          ["sentence", "auto-quote-close"],
          "」"
        );
      }

      // no quotes are added
      if (!existingQuote && !autoQuote) {
        // defaults to having quotes, in case javascript fails to load for some reason
        openQuoteEle.innerText = "";
        closeQuoteEle.innerText = "";

        sentEle.style["text-indent"] = "0em";
        sentEle.style["padding-left"] = "0em";
      }

      ///

      sentEle.children[1].innerHTML = result;
    };

    /*
     * Toggles the display of any given details tag
     */
    var toggleDetailsTag = function (ele) {
      if (ele.hasAttribute("open")) {
        ele.removeAttribute("open");
      } else {
        ele.setAttribute("open", "true");
      }
    };

    function processSentences(isAltDisplay, isClozeDeletion) {
      var sentences = document.querySelectorAll(".expression--sentence");

      if (sentences !== null) {
        for (let sent of sentences) {
          processSentence(sent, isAltDisplay, isClozeDeletion);
        }
      }
    }

    ///  /// note.card_type != "pa_word"

    ///

    ///

    // creates a custom image container to hold yomichan images
    function createImgContainer(imgName) {
      // creating this programmically:
      // <span class="glossary__image-container">
      //   <a class="glossary__image-hover-text" href='javascript:;'>[Image]</a>
      //   <img class="glossary__image-hover-media" src="${imgName}">
      // </span>

      var defSpan = document.createElement("span");
      defSpan.classList.add("glossary__image-container");

      var defAnc = document.createElement("a");
      defAnc.classList.add("glossary__image-hover-text");
      defAnc.href = "javascript:;'>[Image]";
      defAnc.textContent = "[Image]";

      var defImg = document.createElement("img");
      defImg.classList.add("glossary__image-hover-media");
      defImg.src = imgName;

      defImg.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
      };

      defAnc.onclick = function () {
        modal.style.display = "block";
        modalImg.src = defImg.src;
      };

      defSpan.appendChild(defAnc);
      defSpan.appendChild(defImg);

      return defSpan;
    }
    ///

    ///
    ///

    // shift to switch between sentence & word on click & hover cards
    // NOTICE: we MUST use document.onkeyup instead of document.addEventListener(...)
    // because functions persist and cannot be easily removed within anki,
    // whereas .onkeyup = ... replaces the previous function with the current.
    document.onkeyup = (e) => {
      var keys = null;

      // tests for the existance of extraKeybindSettings
      //if (typeof extraKeybindSettings !== 'undefined') {
      //  extraKeybindSettings(e);
      //}

      ///

      ///

      ///
      ///

      /// {{#WordAudio}}
      //keys = settings.keybind("play-word-audio");
      keys = getSetting(["keybinds", "play-word-audio"], ["w"]);

      if (keys !== null && keys.includes(e.key)) {
        var elem = document.querySelector(
          "#word-audio .soundLink, #word-audio .replaybutton"
        );
        if (elem) {
          elem.click();
        }
      }
      /// {{/WordAudio}}

      /// {{#SentenceAudio}}
      keys = getSetting(["keybinds", "play-sentence-audio"], ["p"]);
      if (keys !== null && keys.includes(e.key)) {
        var hSent = document.getElementById("hybrid-sentence");

        ///
        var elem = document.querySelector(
          "#sentence-audio .soundLink, #sentence-audio .replaybutton"
        );
        if (elem) {
          elem.click();
        }
        ///
      }
      /// {{/SentenceAudio}}

      keys = getSetting(
        ["keybinds", "toggle-front-full-sentence-display"],
        ["'"]
      );
      var ele = document.getElementById("full_sentence_front_details");
      if (keys !== null && ele && keys.includes(e.key)) {
        toggleDetailsTag(ele);
      }

      /// {{#Hint}}
      keys = getSetting(["keybinds", "toggle-hint-display"], ["."]);
      var ele = document.getElementById("hint_details");
      if (keys !== null && ele && keys.includes(e.key)) {
        toggleDetailsTag(ele);
      }
      /// {{/Hint}}

      ///
      /// {{#SecondaryDefinition}}
      keys = getSetting(
        ["keybinds", "toggle-secondary-definitions-display"],
        ["8"]
      );
      var ele = document.getElementById("secondary_definition_details");
      if (keys !== null && ele && keys.includes(e.key)) {
        toggleDetailsTag(ele);
      }
      /// {{/SecondaryDefinition}}

      /// {{#AdditionalNotes}}
      keys = getSetting(["keybinds", "toggle-additional-notes-display"], ["9"]);
      var ele = document.getElementById("additional_notes_details");
      if (keys !== null && ele && keys.includes(e.key)) {
        toggleDetailsTag(ele);
      }
      /// {{/AdditionalNotes}}

      /// {{#ExtraDefinitions}}
      keys = getSetting(
        ["keybinds", "toggle-extra-definitions-display"],
        ["0"]
      );
      var ele = document.getElementById("extra_definitions_details");
      if (keys !== null && ele && keys.includes(e.key)) {
        toggleDetailsTag(ele);
      }
      /// {{/ExtraDefinitions}}

      if (
        "{{#PAGraphs}}a{{/PAGraphs}}{{#UtilityDictionaries}}a{{/UtilityDictionaries}}"
      ) {
        keys = getSetting(["keybinds", "toggle-extra-info-display"], ["["]);
        var ele = document.getElementById("extra_info_details");
        if (keys !== null && ele && keys.includes(e.key)) {
          toggleDetailsTag(ele);
        }
      }
      ///
    };

    //var OPTIONS_FILE = "jp-mining-note-options.js"; // const screws up anki for some reason lol
    //var injectScript = (src) => {
    //  return new Promise((resolve, reject) => {
    //    const script = document.createElement('script');
    //    script.src = src;
    //    script.async = true;
    //    script.onload = resolve;
    //    script.onerror = function(errorEvent) {
    //      // seems only to error if the options file is not found
    //      // syntax errors trigger the sanity check section and javascript error section
    //      logger.error("Options file not found! Make sure `" + OPTIONS_FILE + "` is placed in the media folder.");
    //    }
    //    document.head.appendChild(script);
    //  });
    //};

    //(async () => {

    //if (typeof JPMNOpts === 'undefined') {
    //  await injectScript(OPTIONS_FILE);
    //}

    //let JPMNOpts = createOptions();

    // sanity check
    if (typeof JPMNOpts === "undefined") {
      logger.error(
        "JPMNOpts was not defined in the options file. Was there an error?"
      );
    }

    // removes extra info section if not necessary
    var ele = document.querySelector(".pa-graphs");
    if (
      ele !== null &&
      ele.innerText.trim() === "No pitch accent data" &&
      !"{{#UtilityDictionaries}}a{{/UtilityDictionaries}}"
    ) {
      document.getElementById("extra_info_details").style.display = "none";
    }

    ///

    ///

    // checks leech
    var tags = "{{Tags}}".split(" ");
    if (tags.includes("leech")) {
      logger.leech();
    }

    // a bit of a hack...
    // The only reason why the downstep arrow exists in the first place is to make the downstep
    // mark visible while editing the field in anki. Otherwise, there is no reason for it to exist.
    var wp = document.getElementById("dh_word_pitch");
    wp.innerHTML = wp.innerHTML.replace(/&#42780/g, "").replace(/ꜜ/g, "");

    var modal = document.getElementById("modal");
    var modalImg = document.getElementById("bigimg");

    // restricting the max height of image to the definition box
    var dhLeft = document.getElementById("dh_left");
    var dhRight = document.getElementById("dh_right");
    var heightLeft = dhLeft.offsetHeight;

    if (dhRight) {
      dhRight.style.maxHeight = heightLeft + "px";

      // setting up the modal styles and clicking
      var dhImgContainer = document.getElementById("dh_img_container");
      var imgList = dhImgContainer.getElementsByTagName("img");

      if (imgList && imgList.length === 1) {
        var img = dhImgContainer.getElementsByTagName("img")[0];
        img.classList.add("dh-right__img");
        img.style.maxHeight = heightLeft + "px"; // restricts max height here too

        img.onclick = function () {
          modal.style.display = "block";
          modalImg.src = this.src;
        };
      } else {
        // otherwise we hope that there are 0 images here
        // support for no images here: remove the fade-in / fade-out on text
        // the slightly hacky method is just to remove the class all together lol
        dhImgContainer.className = "";
      }
    }

    // close the modal upon click
    modal.onclick = function () {
      bigimg.classList.add("modal-img__zoom-out");
      modal.classList.add("modal-img__zoom-out");
      setTimeout(function () {
        modal.style.display = "none";
        bigimg.className = "modal-img";
        modal.className = "modal";
      }, 200);
    };

    // remove all jmdict english dict tags
    //var glossaryEle = document.getElementById("primary_definition");
    //glossaryEle.innerHTML = glossaryEle.innerHTML.replace(/, JMdict \(English\)/g, "");

    // goes through each blockquote and searches for yomichan inserted images
    let imageSearchElements = document.getElementsByTagName("blockquote");
    for (let searchEle of imageSearchElements) {
      let anchorTags = searchEle.getElementsByTagName("a");
      for (let atag of anchorTags) {
        let imgFileName = atag.getAttribute("href");
        if (
          imgFileName &&
          imgFileName.substring(0, 25) === "yomichan_dictionary_media"
        ) {
          let fragment = createImgContainer(imgFileName);
          atag.parentNode.replaceChild(fragment, atag);
        }
      }
    }

    ///

    var isAltDisplay = false;
    /* {{#AltDisplay}} */
    isAltDisplay = false;
    /* {{/AltDisplay}} */

    processSentences(isAltDisplay, true);

    ///
    ///

    //})();
  })();
</script>
